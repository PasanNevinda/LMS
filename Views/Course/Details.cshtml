@using Microsoft.AspNetCore.Mvc.ViewFeatures
@model LMS.ViewModels.CourseDetailsVms.CourseDetailsVm
@{
    Layout = null;
    ViewData["Title"] = "Course";
}

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
<link rel="stylesheet" href="~/css/course-details.css" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <div class="course-header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-start">
                <div class="flex-grow-1">
                    <h1 class="course-title">@Model.Name</h1>
                    <div class="course-meta">
                        <div class="meta-item"><i class="fas fa-language"></i><span>@Model.Language</span></div>
                        <div class="meta-item"><i class="fas fa-dollar-sign"></i><span>$@Model.Price</span></div>
                        <div class="meta-item"><i class="fas fa-star"></i><span>@Model.Rating</span></div>
                        <div class="meta-item"><i class="fas fa-users"></i><span><!-- optional: students count --> — students</span></div>
                    </div>
                    <p class="mt-3 mb-0" style="opacity: .9">@Model.Description</p>
                </div>

                <div class="ms-4">
                    @* Server renders the edit button only for owners *@
                    @if (Model.IsOwner )
                    {
                        <button id="toggleEditMode" class="edit-mode-toggle">
                            <i class="fas fa-edit me-2"></i> Edit Course
                        </button>
                    }
                </div>
            </div>
        </div>
    </div>


<div class="container modules-container mt-4">
    @* <div class="alert alert-edit-mode" style="display:none;">
        <div class="d-flex align-items-center">
            <i class="fas fa-info-circle me-3"></i>
            <div>
                <strong>Edit Mode Active</strong>
                <p class="mb-0">You can add, edit or delete modules and items. Changes save via AJAX.</p>
            </div>
        </div>
    </div> *@

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">Course Content</h2>

        @* Render the add-module UI container only for the owner (server-side) *@
        @if (Model.IsOwner)
        {
            <div class="add-module-section">
                <button class="btn-add" onclick="openAddModuleModal(@Model.Id)"><i class="fas fa-plus me-2"></i> Add Module</button>
            </div>
        }
    </div>

    <div id="modulesList">
        @* pass the IsOwner flag into each partial via ViewData so the partial can render module actions server-side *@
        @foreach (var m in Model.Modules)
        {
            var vd = new ViewDataDictionary(ViewData) { ["IsOwner"] = Model.IsOwner };
            @await Html.PartialAsync("_ModulePartial", m, vd)
        }
    </div>

    <div class="empty-state" style="display:@(Model.Modules.Any() ? "none" : "block")">
        <i class="fas fa-book-open"></i>
        <h4>No modules yet</h4>
        @if (Model.IsOwner)
        {
            <p>Start building your course by adding your first module.</p>
            <button class="btn-add mt-3" onclick="openAddModuleModal(@Model.Id)"><i class="fas fa-plus me-2"></i>Add Your First Module</button>
        }
    </div>
</div>

@* Shared modal for server-rendered module forms (Add/Edit) *@
<!-- Add Module Modal -->
<div class="modal fade" id="module-form-model" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="module-form-title">Modal</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="module-form-body">
                <!-- server HTML inserted here -->
            </div>
        </div>
    </div>
</div>




<script src="/js/course-detail.js"></script>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="~/js/site.js" asp-append-version="true"></script>